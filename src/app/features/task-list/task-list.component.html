<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4 bg-white p-4 rounded-xxl shadow-soft glass">
    <div>
      <h1 class="display-6 fw-bold mb-2">Task Manager</h1>
      <p class="text-secondary mb-0">Manage your tasks efficiently</p>
    </div>
    <button
      class="btn btn-accent d-flex align-items-center gap-2 hover-lift"
      (click)="openAddTaskDialog()"
    >
      <span class="material-icons">add_circle</span>
      Add Task
    </button>
  </div>

  <div class="row g-4">
    <div
      *ngFor="let task of tasks"
      class="col-12"
    >
      <div class="card border-0 shadow-soft hover-lift rounded-xl border-start border-5"
        [ngClass]="{
          'border-warning': task.status === 'Pending',
          'border-info': task.status === 'In Progress',
          'border-success': task.status === 'Completed'
        }"
      >
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div class="flex-grow-1 me-3">
              <h2 class="h5 fw-semibold mb-2">{{ task.title }}</h2>
              <div class="d-flex align-items-center gap-2 mb-2">
                <span class="badge badge-accent rounded-pill px-3 py-1 me-1" *ngIf="task.category">{{ task.category }}</span>
                <span class="badge rounded-pill px-3 py-1"
                  [ngClass]="{
                    'bg-warning text-warning-emphasis': task.status === 'Pending',
                    'bg-info text-info-emphasis': task.status === 'In Progress',
                    'bg-success text-success-emphasis': task.status === 'Completed'
                  }"
                >{{ task.status }}</span>
                <ng-container *ngIf="task.assignees">
                  <span *ngFor="let user of task.assignees" class="avatar-chip rounded-circle bg-accent text-white fw-bold ms-1" style="width:28px;height:28px;display:inline-flex;align-items:center;justify-content:center;font-size:0.95rem;">{{ user[0] }}</span>
                </ng-container>
              </div>
              <div class="text-secondary mb-2" [innerHTML]="task.description | slice:0:180"></div>
              <div class="progress-pill mb-2"><span [style.width]="task.progress ? task.progress + '%' : '33%'"></span></div>
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top">
            <div class="d-flex align-items-center text-secondary">
              <span class="material-icons me-2">event</span>
              <small>
                Due: {{ task.deadline | date:'MMM d, y' }}
              </small>
            </div>
            <div class="btn-group">
              <button
                class="btn btn-outline-secondary btn-sm d-inline-flex align-items-center hover-lift"
                (click)="openEditTaskDialog(task)"
              >
                <span class="material-icons me-2">edit</span>
                Edit
              </button>
              <button
                class="btn btn-outline-secondary btn-sm d-inline-flex align-items-center hover-lift"
                [routerLink]="['/tasks', task.id]"
              >
                <span class="material-icons me-2">visibility</span>
                View Details
              </button>
              <button
                class="btn btn-outline-danger btn-sm d-inline-flex align-items-center hover-lift"
                (click)="deleteTask(task.id)"
              >
                <span class="material-icons me-2">delete</span>
                Delete
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
  </div>

  <app-task-dialog
    *ngIf="showDialog && selectedTask"
    [task]="selectedTask"
    (save)="onSaveTask($event)"
    (cancel)="closeDialog()"
  ></app-task-dialog>
